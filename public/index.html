<!DOCTYPE html>
<html lang="en">
     <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    </head>
    <div class="container">
        <label for="exampleFormControlInput1" class="form-label">Name</label>
        <input type="text" class="form-control" id="nameForm" placeholder="Anonymous">

        <label for="exampleFormControlTextarea1" class="form-label">Message</label>
        <textarea class="form-control" id="messageForm" rows="3" placeholder="2000 characters max"></textarea>

        <button type="button" id="postButton" class="btn btn-primary">Post</button>
    </div>
    <div class="variable-container">
    </div>


<script>
  const postButton = document.getElementById('postButton');
  const nameString = document.getElementById('nameForm');
  const messageString = document.getElementById('messageForm');
  var array = [];
  const baseURL = 'http://localhost:3000/';

  postButton.addEventListener('click', postInfo);

  window.onload = async function getInfo(){
    const req = await fetch(baseURL + 'api/posts',
    {
        method: 'GET',
        headers:{
          "Content-Type": 'application/json'
        }
    });
    console.log(res);
    const data = await res.json();
    array = data;

    const variableContainer = document.querySelector('.variable-container');
    variableContainer.innerHTML = ''; // Clear previous content

    array[0].forEach(item => {
      const idElement = document.createElement('p');
      idElement.textContent = `ID: ${item.id}`;
      variableContainer.appendChild(idElement);

      const nameElement = document.createElement('p');
      nameElement.textContent = `Name: ${item.name_string}`;
      variableContainer.appendChild(nameElement);

      const messageElement = document.createElement('p');
      messageElement.textContent = `Message: ${item.message}`;
      variableContainer.appendChild(messageElement);

      const dateElement = document.createElement('p');
      dateElement.textContent = `Date: ${item.post_timestamp}`;
      variableContainer.appendChild(dateElement);
    });
  }


  async function postInfo(e){
    e.preventDefault();//prevents refresh
    if (nameString.value == '' || messageString.value == ''){return}//prevent empty strings
    const res = await fetch(baseURL + 'api/posts',
    {
        method: 'POST',
        headers:{
          "Content-Type": 'application/json'
        },
        body: JSON.stringify ({
          name_string: nameString.value,
          message: messageString.value
        })
    })
    console.log(res);
  }
</script>
</html>

